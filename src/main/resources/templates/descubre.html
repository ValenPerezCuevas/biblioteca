<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alexandría - Descubre</title>
    <!-- Enlace a Bootstrap CSS -->
    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/bootstrap-grid.css" rel="stylesheet">
    <link href="/css/bootstrap-reboot.css" rel="stylesheet">
    <link href="/css/bootstrap-utilities.css" rel="stylesheet">

    <style>

        /* Estilos para el aside */
        aside {
            background-color: #E3B7A0;
            color: #8a6041;
            padding: 20px;
        }

        label.form-label {
            /*font-weight: bolder;*/
            font-size: larger;
        }

        .modal-title, .card-title {
            color: #8a6041;
        }

        .modal-body span {
            font-size: larger;
            color: #8a6041;
        }

        ul {
            list-style: none;
        }

        .card {
            width: 200px;
            /*margin-bottom: 20px;*/
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* 200px como mínimo, con el ancho restante distribuido igualmente */
            gap: 20px; /* Espacio entre las tarjetas */
            justify-content: center;
        }

        .card-img-top {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .card-body {
            display: flex;
            flex-direction: column;
            justify-content: space-evenly;
        }


        /* ESTILOS CHECKOBOX - SIN APLICAR - */

        .checkbox-wrapper input[type="checkbox"] {
            visibility: hidden;
            display: none;
        }

        .checkbox-wrapper *,
        .checkbox-wrapper ::after,
        .checkbox-wrapper ::before {
            box-sizing: border-box;
            user-select: none;
        }

        .checkbox-wrapper {
            position: relative;
            display: block;
            overflow: hidden;
        }

        .checkbox-wrapper .label {
            cursor: pointer;
        }

        .checkbox-wrapper .check {
            width: 50px;
            height: 50px;
            position: absolute;
            opacity: 0;
        }

        .checkbox-wrapper .label svg {
            vertical-align: middle;
        }

        .checkbox-wrapper .path1 {
            stroke-dasharray: 400;
            stroke-dashoffset: 400;
            transition: .5s stroke-dashoffset;
            opacity: 0;
        }

        .checkbox-wrapper .check:checked + label svg g path {
            stroke-dashoffset: 0;
            opacity: 1;
        }

    </style>
</head>
<body>

<!-- Incluir el encabezado compartido -->
<div th:replace="header :: header"></div>

<div class="container-fluid ">
    <div class="row justify-content-evenly">
        <!-- Aside en la parte izquierda -->
        <aside class="col-md-3">
            <h3>Filtros de búsqueda</h3>
            <form id="filters-form" th:action="@{/descubre/filtrar}" method="get">
                <!-- Filtro por título -->
                <div class="mb-3">
                    <label for="filter-title" class="form-label">Título</label>
                    <input type="text" name="titulo" class="form-control" id="filter-title" placeholder="Introduce un título">
                </div>
                <!-- Filtro por autor -->
                <div class="mb-3">
                    <label for="filter-author" class="form-label">Autor</label>
                    <input type="text" name="autor" class="form-control" id="filter-author" placeholder="Introduce un autor">
                </div>
                <!-- Filtro por editorial -->
                <div class="mb-3">
                    <label for="filter-editorial" class="form-label">Editorial</label>
                    <input type="text" name="editorial" class="form-control" id="filter-editorial" placeholder="Introduce una editorial">
                </div>
                <!-- Filtro por género -->
                <div class="mb-3">
                    <label class="form-label">Género</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="novela" id="gen-novela">
                        <label class="form-check-label" for="gen-novela">Novela</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="novela negra" id="gen-novela-negra">
                        <label class="form-check-label" for="gen-novela-negra">Novela negra</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="ficción" id="gen-ficcion">
                        <label class="form-check-label" for="gen-ficcion">Ficción</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="ciencia ficción" id="gen-ciencia-ficcion">
                        <label class="form-check-label" for="gen-ciencia-ficcion">Ciencia Ficción</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="fantasía" id="gen-fantasia">
                        <label class="form-check-label" for="gen-fantasia">Fantasía</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="terror" id="gen-terror">
                        <label class="form-check-label" for="gen-terror">Terror</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="suspense" id="gen-suspense">
                        <label class="form-check-label" for="gen-suspense">Suspense</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="autoayuda" id="gen-autoayuda">
                        <label class="form-check-label" for="gen-autoayuda">Autoayuda</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="filosofia" id="gen-filosofia">
                        <label class="form-check-label" for="gen-filosofia">Filosofía</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="juvenil" id="gen-juvenil">
                        <label class="form-check-label" for="gen-juvenil">Juvenil</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="programacion" id="gen-programacion">
                        <label class="form-check-label" for="gen-programacion">Programación</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genero" value="no ficcion" id="gen-no-ficción">
                        <label class="form-check-label" for="gen-no-ficción">No ficción</label>
                    </div>
                    <!-- Campo de texto para otro género -->
                    <div class="mt-2">
                        <input type="text" name="generoOtro" class="form-control" id="filter-other-genre" placeholder="Otro género">
                    </div>
                </div>
                <!-- Filtro por rango de año de publicación -->
                <div class="mb-3">
                    <label for="filter-year-from" class="form-label">Año de publicación desde</label>
                    <input type="number" name="anoDesde" class="form-control" id="filter-year-from" placeholder="Desde">
                </div>
                <div class="mb-3">
                    <label for="filter-year-to" class="form-label">Año de publicación hasta</label>
                    <input type="number" name="anoHasta" class="form-control" id="filter-year-to" placeholder="Hasta">
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top: 2rem !important;">Aplicar filtros</button>
            </form>
        </aside>

        <!-- Contenido principal para libros -->
        <div class="col-md-9">
            <div class="cards-container">
                <!-- ALERTA no resultados -->
                <div th:if="${noResultados}" class="alert alert-warning" role="alert">
                    <p th:text="${noResultados}"></p>
                </div>
                <div th:each="libro : ${libros}" class="card">
                    <img th:src="@{'/imagenes/Imagenes_libros/' + ${libro.id_libros} + '.jpg'}" class="card-img-top" alt="Portada del libro">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${libro.titulo}">Título del libro</h5>
                        <p class="card-text">Autor: <span th:text="${libro.autor}">Autor del libro</span></p>
                        <button type="button" class="btn btn-info" title="Ver info"
                                th:attr="onclick='mostrarInfo(' + ${libro.id_libros} + ')'">
                            Ver Info
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<br>

<!-- Controles de Paginación (solo si hay resultados) -->
<div th:if="${not #lists.isEmpty(libros)}">
    <!-- Controles de Paginación ventana grande -->
    <nav aria-label="Page navigation example" class="d-none d-md-block"  style="background-color: transparent">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:class="${paginaActual == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/descubre(pagina=0, sortBy=${sortBy}, sortOrder=${sortOrder})}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li th:each="num : ${#numbers.sequence(0, totalPaginas - 1)}" class="page-item" th:classappend="${num == paginaActual} ? 'active'">
                <a class="page-link" th:href="@{/descubre(pagina=${num}, sortBy=${sortBy}, sortOrder=${sortOrder})}" th:text="${num + 1}"></a>
            </li>
            <li class="page-item" th:class="${paginaActual == totalPaginas - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/descubre(pagina=${totalPaginas - 1}, sortBy=${sortBy}, sortOrder=${sortOrder})}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

<!-- Controles de Paginación ventana pequeña -->
<nav aria-label="Page navigation" class="d-md-none">
    <ul class="pagination justify-content-center">
        <li class="page-item" th:class="${paginaActual == 0} ? 'disabled'">
            <a class="page-link" th:href="@{/descubre(pagina=0, sortBy=${sortBy}, sortOrder=${sortOrder})}" aria-label="Primera">
                <span aria-hidden="true">&laquo;&laquo;</span>
                <span class="visually-hidden">Primera</span>
            </a>
        </li>
        <li class="page-item" th:class="${paginaActual == 0} ? 'disabled'">
            <a class="page-link" th:href="@{/descubre(pagina=${paginaActual - 1}, sortBy=${sortBy}, sortOrder=${sortOrder})}" aria-label="Anterior">
                <span aria-hidden="true">&laquo;</span>
                <span class="visually-hidden">Anterior</span>
            </a>
        </li>
        <li class="page-item">
            <span class="page-link" th:text="${paginaActual + 1} + ' de ' + ${totalPaginas}"></span>
        </li>
        <li class="page-item" th:class="${paginaActual == totalPaginas - 1} ? 'disabled'">
            <a class="page-link" th:href="@{/descubre(pagina=${paginaActual + 1}, sortBy=${sortBy}, sortOrder=${sortOrder})}" aria-label="Siguiente">
                <span aria-hidden="true">&raquo;</span>
                <span class="visually-hidden">Siguiente</span>
            </a>
        </li>
        <li class="page-item" th:class="${paginaActual == totalPaginas - 1} ? 'disabled'">
            <a class="page-link" th:href="@{/descubre(pagina=${totalPaginas - 1}, sortBy=${sortBy}, sortOrder=${sortOrder})}" aria-label="Última">
                <span aria-hidden="true">&raquo;&raquo;</span>
                <span class="visually-hidden">Última</span>
            </a>
        </li>
    </ul>
</nav>

<!-- Footer -->
<footer class="row d-flex vh-15">
    <div class="d-flex justify-content-center">
        <p id="frase"></p>
    </div>
</footer>

<!-- Modal ver info libro -->
<div class="modal fade" id="verInfoLibro" tabindex="-1" aria-labelledby="verInfoLibroModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modal-titulo" ></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <p>Autor: <span id="modal-autor" ></span></p>
                </div>
                <div class="mb-3">
                    <p>Género: <span id="modal-genero" ></span></p>
                </div>
                <div class="mb-3">
                    <p>Año de publicación: <span id="modal-ano" ></span></p>
                </div>
                <div class="mb-3">
                    <p>Editorial: <span id="modal-editorial" ></span></p>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Scripts de Bootstrap y JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/footer.js"></script>


<script>
    function mostrarInfo(libroId) {
        let url = '/descubre/obtenerInfoLibro/' + libroId;

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al cargar la información del libro');
                }
                return response.json();
            })
            .then(data => {
                console.log(data); // Para depuración
                document.querySelector('#verInfoLibro #modal-titulo').textContent = data.titulo;
                document.querySelector('#verInfoLibro #modal-autor').textContent = data.autor;
                document.querySelector('#verInfoLibro #modal-genero').textContent = data.genero;
                document.querySelector('#verInfoLibro #modal-ano').textContent = data.anoPublicacion;
                document.querySelector('#verInfoLibro #modal-editorial').textContent = data.editorial;

                // Mostrar el modal
                let verInfoModal = new bootstrap.Modal(document.getElementById('verInfoLibro'));
                verInfoModal.show();
            })
            .catch(error => {
                console.error(error); // Para depuración
                alert('No se pudo cargar la información del libro: ' + error.message);
            });
    }

</script>

</body>
</html>
